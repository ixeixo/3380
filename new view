import tkinter as tk
from tkinter import ttk
from tkinter import filedialog
from tkinter import *
from PIL import ImageTk, Image
from controller import Sendfile


class View(ttk.Frame):
    def __init__(self, parent):
        super().__init__(parent)
        self.controller = Controller

        # set window title
        self.winfo_toplevel().title("Image Hashing Program")

        # create widgets
        # label
        self.uploadLabel = ttk.Label(self, text=' ', wraplength=210)
        self.uploadLabel.grid(row=1, column=1)

        # upload photo button
        self.uploadPhoto_button = ttk.Button(self, text='Choose Photo', width=30, command=self.browseFiles)
        self.uploadPhoto_button.grid(row=2, column=1, padx=5)

        # hashify button
        self.hashify_button = ttk.Button(self, text='Hashify', width=30, command=self.Match(),
                                         state=DISABLED)
        self.hashify_button.grid(row=2, column=2, padx=5)

        # check match button
        self.checkMatch_button = ttk.Button(self, text='Check for Match', width=30,
                                            command=Sendfile(self.filename), state=DISABLED)
        self.checkMatch_button.grid(row=2, column=3, padx=5)

        # create empty preview canvas
        self.previewCanvas = tk.Canvas(self, bg='grey', width=550, height=350)
        self.previewCanvas.grid(row=3, column=2, pady=30)

        # set the controller
        self.controller = None

    def set_controller(self, controller):
        self.controller = controller

    def browseFiles(self):
        fileName = filedialog.askopenfilename(initialdir="/",
                                              title="Select a File",
                                              filetypes=(("Text files",
                                                          "*.jpg*"),
                                                         ("all files",
                                                          "*.*")))
        shortFilename = fileName[0:10] + "..." + fileName[-4:]

        # change label contents
        self.uploadLabel.configure(text="File Opened: " + shortFilename)

        self.hashify_button['state'] = NORMAL
        self.checkMatch_button['state'] = NORMAL

        # display image
        previewImage = ImageTk.PhotoImage(Image.open(fileName).resize((500, 300)))
        self.displayPreviewImage = ttk.Label(self, text='Image Preview', width=100, image=previewImage)
        self.displayPreviewImage.image = previewImage
        self.displayPreviewImage.grid(row=3, column=2, pady=30)




    def Match(self):
        self.top = Toplevel()
        self.top.title("Match found input additional info on the image.")


    def open_text(file):
        text_file = open(file, 'r')
        text_file.read()
        my_text.insert(END, text_file)
        text_file.close()


    def save_info():
        text_file = open('', 'w')
        text_file.write(my_text.get(1.0, END))


    save_button = Button(top, text="Save Info", command=save_info)
    save_button.pack(pady=20)

    my_text = Text(top, Width=40, Height=10, font=(Helvetica, 16))
    my_text.pack(pady=20)

    open_button = Button(top, text="See Info", command=open_text())
    open_button.pack(pady=20)


    def nomatch():
        top = Toplevel()
        top.title("No Match input info on the image")


    def save_info():
        text_file = open('', 'w')
        text_file.write(my_text.get(1.0, END))


    save_button = Button(top, text="Save Info", command=save_info)
    save_button.pack(pady=20)

    my_text = Text(top, Width=40, Height=10, font=(Helvetica, 16))
    my_text.pack(pady=20)

    mainloop()
